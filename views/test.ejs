<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8' />
		<title>Filter features within map view</title>
		<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
		<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		
		<!-- <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyD1LCWyuLkzDMvyOYxBIvmjyBJsqLDnPA4"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="javascripts/turf.min.js"></script> -->
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1LCWyuLkzDMvyOYxBIvmjyBJsqLDnPA4&libraries=geometry"></script>
	</head>
	
	<body>
		<div id='map'></div>
		
		<style>
			body { margin:0; padding:0; }
			#map { position:absolute; top:0; bottom:0; width:60%; }
			.mapboxgl-ctrl-bottom-left { display: none }
			/*.mapboxgl-ctrl-bottom-right { display: none }*/
			.marker {
				display: block;
				border: none;
				border-radius: 50%;
				cursor: pointer;
				padding: 0;
				width: 50px;
				height: 50px;
			}
		</style>
		<script src="javascripts/mapbox-utility.js"></script>
		<script>
			var map = initializeMapbox('map', 'streets', [-122.4833858013153, 37.829607404976734], 12);
			map.on('load', function(){
				/*
				// Route
				initializeRouteLayer(map, [{
					route:  [[-122.4833858013153, 37.829607404976734],
									[-122.4830961227417, 37.82932776098012],
									[-122.4830746650696, 37.82932776098012],
									[-122.48218417167662, 37.82889558180985],
									[-122.48218417167662, 37.82890193740421],
									[-122.48221099376678, 37.82868372835086],
									[-122.4822163581848, 37.82868372835086],
									[-122.48205006122589, 37.82801003030873]],
					start: 12132
				}]);
				
				var r = {
					route: [[-122.48393028974533, 37.829471820141016],
									[-122.48395174741744, 37.82940826466351],
									[-122.48395174741744, 37.829412501697064],
									[-122.48423874378203, 37.829357420242125],
									[-122.48422533273697, 37.829361657278575],
									[-122.48459815979002, 37.8293425906126],
									[-122.48458743095398, 37.8293447091313],
									[-122.4847564101219, 37.82932776098012],
									[-122.48474299907684, 37.829331998018276],
									[-122.4849334359169, 37.829298101706186],
									[-122.48492807149889, 37.82930022022615],
									[-122.48509705066681, 37.82920488676767],
									[-122.48509168624878, 37.82920912381288],
									[-122.48520433902739, 37.82905870855876],
									[-122.48519897460936, 37.82905870855876],
									[-122.4854403734207, 37.828594749716714],
									[-122.48543500900269, 37.82860534241688],
									[-122.48571664094925, 37.82808206121068],
									[-122.48570591211319, 37.82809689109353],
									[-122.4858346581459, 37.82797189627337],
									[-122.48582661151886, 37.82797825194729],
									[-122.4859634041786, 37.82788503534145],
									[-122.48595803976059, 37.82788927246246],
									[-122.48605459928514, 37.82786596829394]]
				}
				
				addRoute(map, r)
				
				map.on('mouseenter', 'route', function(e){
					console.log(e.features[0])
					clearRoute(map);
				});
				*/
				// POI
				var points = [[-122.48393028974533, 37.829471820141016],
									[-122.48395174741744, 37.82940826466351],
									[-122.48395174741744, 37.829412501697064],
									[-122.48423874378203, 37.829357420242125],
									[-122.48422533273697, 37.829361657278575],
									[-122.48459815979002, 37.8293425906126],
									[-122.48458743095398, 37.8293447091313],
									[-122.4847564101219, 37.82932776098012],
									[-122.48474299907684, 37.829331998018276],
									[-122.4849334359169, 37.829298101706186],
									[-122.48492807149889, 37.82930022022615],
									[-122.48509705066681, 37.82920488676767],
									[-122.48509168624878, 37.82920912381288],
									[-122.48520433902739, 37.82905870855876],
									[-122.48519897460936, 37.82905870855876],
									[-122.4854403734207, 37.828594749716714],
									[-122.48543500900269, 37.82860534241688],
									[-122.48571664094925, 37.82808206121068],
									[-122.48570591211319, 37.82809689109353],
									[-122.4858346581459, 37.82797189627337],
									[-122.48582661151886, 37.82797825194729],
									[-122.4859634041786, 37.82788503534145],
									[-122.48595803976059, 37.82788927246246],
									[-122.48605459928514, 37.82786596829394]];
				var points = points.map(function(item){
					return {geo: item, name: '1'}
				});
				// console.log(points);
				initializePOILayer(map, points)
				addPOI(map, {geo: [-120.48205006122589, 35.82801003030873]});
				// clearPOI(map);
				
				map.on('click', function(e){
					//console.log(map.getSource('POI'));
					//console.log(e.point);
					var features = map.queryRenderedFeatures({ layers: ['cluster-POI', 'unclustered-POI'] });
					console.log(features[0].geometry.coordinates)
					removeMarkerByID($('#map'), '_ffwqp8shg');
					addMarker(map, {img: 'https://placekitten.com/g/50/50/', geo: features[0].geometry.coordinates})
					//addMarker(map, {img: 'https://placekitten.com/g/50/50/', geo: [-122.4833858013153, 37.829607404976734]})
					
				});
				
				/*
				// Buffer
				initializeBufferLayer(map, [{
					points: [[[-122.48393028974533, 37.829471820141016],
									[-122.48395174741744, 37.82940826466351],
									[-122.48395174741744, 37.829412501697064],
									[-122.48423874378203, 37.829357420242125],
									[-122.48422533273697, 37.829361657278575],
									[-122.48459815979002, 37.8293425906126],
									[-122.48458743095398, 37.8293447091313],
									[-122.4847564101219, 37.82932776098012],
									[-122.48474299907684, 37.829331998018276],
									[-122.4849334359169, 37.829298101706186],
									[-122.48492807149889, 37.82930022022615],
									[-122.48509705066681, 37.82920488676767],
									[-122.48509168624878, 37.82920912381288],
									[-122.48520433902739, 37.82905870855876],
									[-122.48519897460936, 37.82905870855876],
									[-122.4854403734207, 37.828594749716714],
									[-122.48543500900269, 37.82860534241688],
									[-122.48571664094925, 37.82808206121068],
									[-122.48570591211319, 37.82809689109353],
									[-122.4858346581459, 37.82797189627337],
									[-122.48582661151886, 37.82797825194729],
									[-122.4859634041786, 37.82788503534145],
									[-122.48595803976059, 37.82788927246246],
									[-122.48605459928514, 37.82786596829394],
									[-122.48393028974533, 37.829471820141016]]]
				}]) ;
				
				clearBuffer(map);
				addBuffer(map, {
					points: [[[-122.48393028974533, 37.829471820141016],
									[-122.48395174741744, 37.82940826466351],
									[-122.48395174741744, 37.829412501697064],
									[-122.48423874378203, 37.829357420242125],
									[-122.48422533273697, 37.829361657278575],
									[-122.48459815979002, 37.8293425906126],
									[-122.48458743095398, 37.8293447091313],
									[-122.4847564101219, 37.82932776098012],
									[-122.48474299907684, 37.829331998018276],
									[-122.4849334359169, 37.829298101706186],
									[-122.48492807149889, 37.82930022022615],
									[-122.48509705066681, 37.82920488676767],
									[-122.48509168624878, 37.82920912381288],
									[-122.48520433902739, 37.82905870855876],
									[-122.48519897460936, 37.82905870855876],
									[-122.4854403734207, 37.828594749716714],
									[-122.48543500900269, 37.82860534241688],
									[-122.48571664094925, 37.82808206121068],
									[-122.48570591211319, 37.82809689109353],
									[-122.4858346581459, 37.82797189627337],
									[-122.48582661151886, 37.82797825194729],
									[-122.4859634041786, 37.82788503534145],
									[-122.48595803976059, 37.82788927246246],
									[-122.48605459928514, 37.82786596829394],
									[-122.48393028974533, 37.829471820141016]]]
				})
				
				
				//addMarker(map, {img: 'https://placekitten.com/g/50/50/', geo: [-122.4833858013153, 37.829607404976734]});
				
				/*
				map.flyTo({
					center: [-122.4833858013153, 37.829607404976734],
					zoom: 16,
					speed: 5,
					curve: 1,
					easing(t) {
						//console.log(t);
						return t;
					}
				});
				*/
				
	/*			
				var geojson = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "message": "Foo",
                "iconSize": [60, 60]
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    -66.324462890625,
                    -16.024695711685304
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "message": "Bar",
                "iconSize": [50, 50]
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    -61.2158203125,
                    -15.97189158092897
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "message": "Baz",
                "iconSize": [40, 40]
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    -63.29223632812499,
                    -18.28151823530889
                ]
            }
        }
    ]
};

// add markers to map
geojson.features.forEach(function(marker) {
    // create a DOM element for the marker
    var el = document.createElement('div');
    el.className = 'marker';
    el.style.backgroundImage = 'url(https://placekitten.com/g/' + marker.properties.iconSize.join('/') + '/)';
    el.style.width = marker.properties.iconSize[0] + 'px';
    el.style.height = marker.properties.iconSize[1] + 'px';

    el.addEventListener('click', function() {
        window.alert(marker.properties.message);
    });
		console.log(marker.geometry.coordinates)
    // add marker to map
    new mapboxgl.Marker(el)
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);
});
*/
			});
			
			
			
		</script>
	<style>
	
	.dot:before{
	  content:' ';
	  position: absolute;
	  z-index:2;
	  left:0;
	  top:0;
	  width:10px;
	  height:10px; 
	  background-color: #ff4200;
	  border-radius: 50%;
	}

	.dot:after {
	  content:' ';
	  position: absolute;
	  z-index:1;
	  width:10px;
	  height:10px; 
	  background-color: #ff4200;
	  border-radius: 50%;
	  box-shadow: 0 0 10px rgba(0,0,0,.3) inset;
	  -webkit-animation-name:'ripple';/*动画属性名，也就是我们前面keyframes定义的动画名*/
	  -webkit-animation-duration: 1s;/*动画持续时间*/
	  -webkit-animation-timing-function: ease; /*动画频率，和transition-timing-function是一样的*/
	  -webkit-animation-delay: 0s;/*动画延迟时间*/
	  -webkit-animation-iteration-count: infinite;/*定义循环资料，infinite为无限次*/
	  -webkit-animation-direction: normal;/*定义动画方式*/
	}

	@keyframes ripple {
	   0% {
		left:5px;
		top:5px;
		opcity:75;
		width:0;
		height:0;
	  }
	  100% {
		left:-20px;
		top:-20px;
		opacity: 0;
		width:50px;
		height:50px;
	  }
	}
	</style>
	</body>
</html>	

